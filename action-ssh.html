<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<link rel="icon" type="image/png" href="images/icons/OliveTinLogo.png">
<title>OliveTin documentation</title>
<style>
body {
  font-family: sans-serif;
  line-height: 1.5;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-areas: "nav content" "nav footer";
  grid-template-columns: 20em auto;
  grid-template-rows: auto min-content;
  height: 100vh;
  align-items: stretch;
}

a {
  text-decoration: none;
}

a:focus {
  background-color: #bdb76b;
}

#header {
  background-color: #efefef;
  grid-area: nav;
}

#footer {
  grid-area: footer;
  justify-self: center;
  align-self: end;
  padding: 1em;
}

#toc {
  padding: 1em;
}

#toc a {
  color: black;
}

#toc li {
  padding-bottom: .6em;
}

#toc ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

#toc ul ul {
  padding-left: 1.4em;
}

#toctitle {
  font-weight: bold;
  color: black;
}

h1 {
  font-size: 1.4em;
  font-weight: lighter;
  background-color: black;
  padding: .6em;
  margin: 0;
  color: white;
}

#toc a:hover {
  text-decoration: underline;
}

#content {
  background-color: white;
  grid-area: content;
  max-width: 1000px;
  padding: 1em;
  justify-self: center;
}

#content img {
  max-width: 100%;
  vertical-align: middle;
}

pre {
  background-color: #f7f7f8;
  padding: 1em;
  word-wrap: break-word;
  white-space: pre-wrap;
}

table {
  border-collapse: collapse;
}

td, th {
  border: 1px solid gray;
  padding: .4em;
}

th {
  background-color: #f9f9f9;
  text-align: left;
}

.imageblock.right {
  float: right;
}

hr {
  clear: both;
  border: 0;
  border-bottom: 1px solid #efefef;
  margin: 1em;
}

div.admonitionblock td {
  border: 0;
}

div.admonitionblock td:first-child {
  font-weight: bold;
}

.listingblock .title {
  background-color: #efefef;
  margin-bottom: -1em;
  padding: 1em;
}

@media (max-width: 700px) {
  body {
    display: block;
  }
}

</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="action-ssh" class="book toc2 toc-left">
<div id="header">
<h1>OliveTin</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">OliveTin documentation</a></span></p><ul class="sectlevel1">
<li><a href="installation.html">1. Installation</a>
</li>
<li><a href="config.html">2. Configuration</a>
</li>
<li><a href="reverse-proxies.html">3. Reverse Proxies</a>
</li>
<li><a href="actions.html">4. Actions</a>
<ul class="sectlevel2">
<li><a href="action-container-control.html">4.1. Containers - start/stop</a>
</li>
<li><a href="action-service.html">4.2. Restart a systemd service</a>
</li>
<li><a href="action-ping.html">4.3. Ping an address</a>
</li>
<li><a href="action-ssh.html"><span class="toc-current">4.4. SSH into another machine and run a command</span></a>
</li>
<li><a href="powershell.html">4.5. Powershell</a>
</li>
</ul>
</li>
<li><a href="action-customisation.html">5. Action customisation</a>
</li>
<li><a href="args.html">6. Arguments</a>
</li>
<li><a href="auth.html">7. Authentication &amp; Authorization</a>
</li>
<li><a href="_reference.html">8. Reference</a>
</li>
<li><a href="troubleshooting.html">9. Support &amp; Troubleshooting</a>
</li>
<li><a href="api.html">10. API</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="action-ssh"><a class="anchor" href="#action-ssh"></a><a class="link" href="#action-ssh">4.4. SSH into another machine and run a command</a></h3>
<div class="paragraph">
<p>This is probably one of the most useful things OliveTin is used for - just plain old SSH, which allows it to easily connect from a container to any server running on your network to run commands. This is also the preferred method of running commands on the server that is hosting the OliveTin container image as well.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Installation type</th>
<th class="tableblock halign-left valign-top">Difficulty to do this</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running as a <strong>Systemd service</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Easy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running in a <strong>container</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Needs some setting up - see the <a href="action-ssh.html#ssh-container">SSH Container setup instructions</a></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_example_config_yaml_4"><a class="anchor" href="#_example_config_yaml_4"></a><a class="link" href="#_example_config_yaml_4">4.4.1. Example config.yaml</a></h4>
<div class="listingblock">
<div class="title">OliveTin <code>config.yaml</code></div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">actions:
    # This will SSH into a server an run the command 'service httpd restart'
   - title: Restart httpd on Server 1
     shell: ssh root@server-with-olivetin 'service httpd restart'
     icon: ping
     timeout: 5</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note about SSH keys</strong>: You should make sure that the user that OliveTin is running as has access to a SSH key. This applies to container images as well. The setup instructions below briefly explain how to generate a SSH key and make it accessible to OliveTin which is running inside a container.</p>
</div>
</div>
<div class="sect3">
<h4 id="ssh-container"><a class="anchor" href="#ssh-container"></a><a class="link" href="#ssh-container">4.4.2. Setup if running inside a container</a></h4>
<div class="paragraph">
<p><span class="image"><img src="images/ssh-diagram.png" alt="ssh diagram"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The OliveTin container is created with <code>.ssh</code> as a volume mount, that contains a SSH Key.</p>
</li>
<li>
<p>OliveTin uses the SSH key to connect back to server-with-olivetin or across to server2.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_setup_instructions"><a class="anchor" href="#_setup_instructions"></a><a class="link" href="#_setup_instructions">Setup instructions</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On <code>server-with-olivetin</code>, run <code>mkdir /opt/OliveTinSshKeys</code> to create a shared directory for your SSH key file.</p>
<div class="paragraph">
<p>This will later be used as a "volume mount" when you create a docker container.</p>
</div>
</li>
<li>
<p>On <code>server-with-olivetin</code>, run <code>ssh-keygen</code> to generate a SSH key (if you haven&#8217;t already got one).</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enter the file in which to save the key: <code>/opt/OliveTinSshKeys/id_rsa</code></p>
</li>
<li>
<p>Enter passphrase (empty for no passphrase): <code>&lt;enter&gt;</code></p>
<div class="paragraph">
<p>This will create a passwordless SSH key that OliveTin can use. It is safe as long as nobody steals your SSH key file!</p>
</div>
<div class="paragraph">
<p>You should get something that looks like this. If you get a "permission denied" error when creating files, you could run <code>chmod 0777 /opt/OliveTinSshKeys</code> and try again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>root@server-with-olivetin: ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): /opt/OliveTinSshKeys/id_rsa
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /opt/OliveTinSshKeys/id_rsa
Your public key has been saved in /opt/OliveTinSshKeys/id_rsa.pub
The key fingerprint is:
SHA256:t+vGUn+MTeOtRDpxKanO3Cg63+gvAHslZCe3YVNnfWU root@server-with-olivetin
The key's randomart image is:
+---[RSA 3072]----+
|         .. o.  E|
|      + *  o  ...|
|     o = +     . |
|    . . o    . . |
|     o oS . + +  |
|    . o  ..o *o  |
|     . . oo.o*.o |
|      . +*o+oo= .|
|      .=+BX .... |
+----[SHA256------+</pre>
</div>
</div>
<div class="paragraph">
<p>This will create two files, <code>/opt/OliveTinSshKeys/id_rsa</code> (your private key) and <code>/opt/OliveTinSshKeys/id_rsa.pub</code> (your public key).</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Copy your public key to every server you want to connect to.</p>
<div class="paragraph">
<p><code>ssh-copy-id</code> is a really quick and safe way to do this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>root@server-with-olivetin: ssh-copy-id root@server-with-olivetin
(enter your SSH password)
root@server2: ssh-copy-id root@server2
(enter your SSH password)</pre>
</div>
</div>
<div class="paragraph">
<p>You will be asked to login with a password for each server.</p>
</div>
<div class="paragraph">
<p>After you have done that, you will then be able to login with the ssh key instead;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>root@server-with-olivetin: ssh -i /opt/OliveTinSshKeys/id_rsa root@server2
(you should login without a password)</pre>
</div>
</div>
</li>
<li>
<p>Give the SSH key to the OliveTin container.</p>
<div class="paragraph">
<p>The way to do this is via a "volume mount". When you create the container, you use "-v" to specify a volume.</p>
</div>
<div class="paragraph">
<p>You should mount your SSH keys directory into the OliveTin user&#8217;s home directory by creating the container like this;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run -v /opt/OliveTinSshKeys/:/home/olivetin/.ssh/ --name OliveTin jamesread/olivetin</pre>
</div>
</div>
<div class="paragraph">
<p>This also works for things like SSH configuration files, if you want to use them. This is step 1 complete from the diagram above.</p>
</div>
</li>
<li>
<p>Thankfully, step 2 is very simple! <code>ssh</code> commands in your OliveTin <code>config.yaml</code> should work without a password!, and allow OliveTin to access services, files, and other stuff outside of the OliveTin container.</p>
<div class="listingblock">
<div class="title">OliveTin <code>config.yaml</code></div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">actions:
    # This will SSH into a server an run the command 'service httpd restart'
   - title: Restart httpd on Server 1
     shell: ssh root@server-with-olivetin 'service httpd restart'
     icon: ping
     timeout: 5</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="action-ping.html">Ping an address</a> | ↑ Up: <a href="actions.html">Actions</a> | ⌂ Home: <a href="index.html">OliveTin documentation</a> | Next: <a href="powershell.html">Powershell</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-08-18 18:54:44 UTC
</div>
</div>
</body>
</html>