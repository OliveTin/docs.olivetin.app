<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<link rel="icon" type="image/png" href="images/icons/OliveTinLogo.png">
<title>OliveTin documentation</title>
<style>
body {
  font-family: sans-serif;
  line-height: 1.5;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-areas: "nav content" "nav footer";
  grid-template-columns: 20em auto;
  grid-template-rows: auto min-content;
  height: 100vh;
  align-items: stretch;
}

a {
  text-decoration: none;
}

a:focus, #toc a:focus {
  background-color: black;
  color: white;
}

#header {
  background-color: #efefef;
  grid-area: nav;
}

#footer {
  grid-area: footer;
  justify-self: center;
  align-self: end;
  padding: 1em;
}

#toc {
  padding: 1em;
}

#toc a {
  color: black;
}

#toc li {
  padding-bottom: .6em;
}

#toc ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

#toc ul ul {
  padding-left: 1.4em;
}

#toctitle {
  font-weight: bold;
  color: black;
}

h1 {
  font-size: 1.4em;
  font-weight: lighter;
  background-color: black;
  padding: .6em;
  margin: 0;
  color: white;
}

#toc a:hover {
  text-decoration: underline;
}

#content {
  background-color: white;
  grid-area: content;
  max-width: 1000px;
  padding: 1em;
  justify-self: center;
}

#content img {
  max-width: 100%;
  vertical-align: middle;
}

code {
  background-color: #f7f7f8;
}

pre {
  background-color: #f7f7f8;
  padding: 1em;
  word-wrap: break-word;
  white-space: no-wrap;
  overflow: auto;
}

table {
  border-collapse: collapse;
}

td, th {
  border: 1px solid gray;
  padding: .4em;
}

th {
  background-color: #f9f9f9;
  text-align: left;
}

.imageblock.right {
  float: right;
}

.imageblock .title {
  margin-bottom: 2em;
}

hr {
  clear: both;
  border: 0;
  border-bottom: 1px solid #efefef;
  margin: 1em;
}

div.admonitionblock.note {
  background-color: beige;
}

div.admonitionblock td {
  border: 0;
}

div.admonitionblock td:first-child {
  font-weight: bold;
}

.listingblock .title {
  background-color: #efefef;
  margin-bottom: -1em;
  padding: 1em;
}

.red {
  color: white;
  border: 1px solid black;
  padding: .2em;
  font-weight: bold;
  background-color: #cc0000;
}

.red a {
  color: white;
}

@media (max-width: 700px) {
  body {
    display: block;
  }
}


</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="action-ssh" class="book toc2 toc-left">
<div id="header">
<h1>OliveTin</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">OliveTin documentation</a></span></p><ul class="sectlevel1">
<li><a href="installation.html">Installation Guide</a>
</li>
<li><a href="config.html">Configuration</a>
</li>
<li><a href="reverse-proxies.html">Reverse Proxies</a>
</li>
<li><a href="actions.html">Action execution</a>
</li>
<li><a href="action-customisation.html">Action customisation</a>
</li>
<li><a href="examples.html">Action examples</a>
<ul class="sectlevel2">
<li><a href="action-container-control.html">Containers - start/stop</a>
</li>
<li><a href="action-service.html">Restart a systemd service</a>
</li>
<li><a href="action-ping.html">Ping an address</a>
</li>
<li><a href="action-ssh-easy.html">SSH (easy setup)</a>
</li>
<li><a href="action-ssh.html"><span class="toc-current">SSH (manual setup)</span></a>
</li>
<li><a href="powershell.html">Powershell</a>
</li>
<li><a href="ansible-playbook.html">Ansible Playbooks</a>
</li>
</ul>
</li>
<li><a href="args.html">Arguments</a>
</li>
<li><a href="dashboards.html">Dashboards</a>
</li>
<li><a href="entities.html">Entities</a>
</li>
<li><a href="auth.html">Security</a>
</li>
<li><a href="solutions.html">Solutions</a>
</li>
<li><a href="_advanced_configuration.html">Advanced Configuration</a>
</li>
<li><a href="_reference.html">Reference</a>
</li>
<li><a href="troubleshooting.html">Support &amp; Troubleshooting</a>
</li>
<li><a href="api.html">API</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="action-ssh"><a class="anchor" href="#action-ssh"></a><a class="link" href="#action-ssh">SSH (manual setup)</a></h3>
<div class="paragraph">
<p>This is probably one of the most useful things OliveTin is used for - just plain old SSH, which allows it to easily connect from a container to any server running on your network to run commands. This is also the preferred method of running commands on the server that is hosting the OliveTin container image as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There is an easy method of setting up SSH with OliveTin, which is described in the <a href="action-ssh-easy.html">SSH (easy setup)</a> section. This section is for those who want to set up SSH manually.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Installation type</th>
<th class="tableblock halign-left valign-top">Difficulty to do this</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running as a <strong>Systemd service</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Easy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Running in a <strong>container</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Needs some setting up - see the <a href="action-ssh.html#ssh-container">SSH Container setup instructions</a></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_example_config_yaml_4"><a class="anchor" href="#_example_config_yaml_4"></a><a class="link" href="#_example_config_yaml_4">Example config.yaml</a></h4>
<div class="listingblock">
<div class="title">OliveTin <code>config.yaml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">actions:
    <span class="c"># This will SSH into a server an run the command 'service httpd restart'</span>
   - title: Restart httpd on Server 1
     shell: ssh root@server-with-olivetin <span class="s1">'service httpd restart'</span>
     icon: ping
     <span class="nb">timeout</span>: 5</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note about SSH keys</strong>: You should make sure that the user that OliveTin is running as has access to a SSH key. This applies to container images as well. The setup instructions below briefly explain how to generate a SSH key and make it accessible to OliveTin which is running inside a container.</p>
</div>
</div>
<div class="sect3">
<h4 id="ssh-container"><a class="anchor" href="#ssh-container"></a><a class="link" href="#ssh-container">SSH from inside a Container - setup instructions</a></h4>
<div class="paragraph">
<p>This is a two step process;</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="red"><a href="action-ssh.html#ssh-step-1">Step 1</a></span> Give OliveTin a SSH key</p>
</li>
<li>
<p><span class="red"><a href="action-ssh.html#ssh-step-2">Step 2</a></span> Setup actions that use SSH with this key</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Visually, this is what it looks like - OliveTin is running in the (orange) container, and then can either connect back to <em>server-with-olivetin</em> or <em>server2</em>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ssh-diagram.png" alt="ssh diagram"></span></p>
</div>
<div class="paragraph">
<p>The steps in detail are below;</p>
</div>
</div>
<div class="sect3">
<h4 id="ssh-step-1"><a class="anchor" href="#ssh-step-1"></a><a class="link" href="#ssh-step-1"><span class="red">Step 1</span>: Give OliveTin a SSH key</a></h4>
<div class="paragraph">
<p>Open a terminal window on <em>server-with-olivetin</em>.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Run <code>mkdir /opt/OliveTinSshKeys</code> to create a shared directory for your SSH key file.</p>
<div class="paragraph">
<p>This will later be used as a "volume mount" when you create a docker container.</p>
</div>
</li>
<li>
<p>Run <code>ssh-keygen</code> to generate a SSH key just for OliveTin.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Enter the file in which to save the key: <code>/opt/OliveTinSshKeys/id_rsa</code></p>
</li>
<li>
<p>Enter passphrase (empty for no passphrase): <code>&lt;enter&gt;</code></p>
<div class="paragraph">
<p>This will create a passwordless SSH key that OliveTin can use. It is safe as long as nobody steals your SSH key file! OliveTin cannot enter passwords into SSH keys, so you have to leave the password blank.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>You should get something that looks like this. If you get a "permission denied" error when creating files, try running <code>chmod 0777 /opt/OliveTinSshKeys</code> and try again.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>root@server-with-olivetin: ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): /opt/OliveTinSshKeys/id_rsa
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /opt/OliveTinSshKeys/id_rsa
Your public key has been saved in /opt/OliveTinSshKeys/id_rsa.pub
The key fingerprint is:
SHA256:t+vGUn+MTeOtRDpxKanO3Cg63+gvAHslZCe3YVNnfWU root@server-with-olivetin
The key's randomart image is:
+---[RSA 3072]----+
|         .. o.  E|
|      + *  o  ...|
|     o = +     . |
|    . . o    . . |
|     o oS . + +  |
|    . o  ..o *o  |
|     . . oo.o*.o |
|      . +*o+oo= .|
|      .=+BX .... |
+----[SHA256------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create two files, <code>/opt/OliveTinSshKeys/id_rsa</code> (your private key) and <code>/opt/OliveTinSshKeys/id_rsa.pub</code> (your public key).</p>
</div>
</li>
<li>
<p>Copy your public key to every server you want to connect to.</p>
<div class="paragraph">
<p>Using the <code>ssh-copy-id</code> command is a really quick and safe way to do this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>root@server-with-olivetin: ssh-copy-id -i /opt/OliveTinSshKeys/id_rsa.pub root@localhost
(enter your SSH password)

root@server2: ssh-copy-id ssh-copy-id -i /opt/OliveTinSshKeys/id_rsa.pub root@server2
(enter your SSH password)</pre>
</div>
</div>
<div class="paragraph">
<p>You will be asked to login with a password for each server.</p>
</div>
<div class="paragraph">
<p>After you have done that, you will then be able to login with the ssh key instead. Here is a quick way that you can test your SSH key manually;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>root@server-with-olivetin: ssh -i /opt/OliveTinSshKeys/id_rsa root@server2
(you should login without a password)</pre>
</div>
</div>
</li>
<li>
<p>Give the SSH key to the OliveTin container.</p>
<div class="paragraph">
<p>The way to do this is via a "volume mount". When you create the container, you use "-v" to specify a volume.</p>
</div>
<div class="paragraph">
<p>You should mount your SSH keys directory into the OliveTin user&#8217;s home directory by creating the container like this;</p>
</div>
<div class="listingblock">
<div class="title">If you want to create the container from the command line</div>
<div class="content">
<pre>docker run -v /opt/OliveTinSshKeys/:/home/olivetin/.ssh/ -v /etc/OliveTin/:/config --name OliveTin jamesread/olivetin</pre>
</div>
</div>
<div class="listingblock">
<div class="title">If you are using docker-compose</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
    <span class="na">olivetin</span><span class="pi">:</span>
        <span class="na">container_name</span><span class="pi">:</span> <span class="s">olivetin</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">jamesread/olivetin</span>
        <span class="na">volumes</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">/etc/OliveTin/:/config"</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">/opt/OliveTinSshKeys:/home/olivetin/.ssh"</span>
        <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s2">"</span><span class="s">1337:1337"</span>
        <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This also works for things like SSH configuration files, if you want to use them. This is step 1 complete from the diagram above.</p>
</div>
</div>
<div class="sect3">
<h4 id="ssh-step-2"><a class="anchor" href="#ssh-step-2"></a><a class="link" href="#ssh-step-2"><span class="red">Step 2</span>: Setup actions that use SSH with this key</a></h4>
<div class="paragraph">
<p>Thankfully, step 2 is very simple! <code>ssh</code> commands in your OliveTin <code>config.yaml</code> should work without a password!, and allow OliveTin to access services, files, and other stuff outside of the OliveTin container.</p>
</div>
<div class="listingblock">
<div class="title">OliveTin <code>config.yaml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">actions:
    <span class="c"># This will SSH into a server an run the command 'service httpd restart'</span>
   - title: Restart httpd on Server 1
     shell: ssh root@server-with-olivetin <span class="s1">'service httpd restart'</span>
     icon: ping
     <span class="nb">timeout</span>: 5</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="action-ssh-easy.html">SSH (easy setup)</a> | ↑ Up: <a href="examples.html">Action examples</a> | ⌂ Home: <a href="index.html">OliveTin documentation</a> | Next: <a href="powershell.html">Powershell</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-07-14 09:00:06 UTC
</div>
</div>
</body>
</html>