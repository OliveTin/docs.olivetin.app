<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<link rel="icon" type="image/png" href="images/icons/OliveTinLogo.png">
<title>OliveTin documentation</title>
<style>
body {
  font-family: sans-serif;
  line-height: 1.5;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-areas: "nav content" "nav footer";
  grid-template-columns: 20em auto;
  grid-template-rows: auto min-content;
  height: 100vh;
  align-items: stretch;
}

a {
  text-decoration: none;
}

a:focus, #toc a:focus {
  background-color: black;
  color: white;
}

#header {
  background-color: #efefef;
  grid-area: nav;
}

#footer {
  grid-area: footer;
  justify-self: center;
  align-self: end;
  padding: 1em;
}

#toc {
  padding: 1em;
}

#toc a {
  color: black;
}

#toc li {
  padding-bottom: .6em;
}

#toc ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

#toc ul ul {
  padding-left: 1.4em;
}

#toctitle {
  font-weight: bold;
  color: black;
}

h1 {
  font-size: 1.4em;
  font-weight: lighter;
  background-color: black;
  padding: .6em;
  margin: 0;
  color: white;
}

#toc a:hover {
  text-decoration: underline;
}

#content {
  background-color: white;
  grid-area: content;
  max-width: 1000px;
  padding: 1em;
  justify-self: center;
}

#content img {
  max-width: 100%;
  vertical-align: middle;
}

code {
  background-color: #f7f7f8;
}

pre {
  background-color: #f7f7f8;
  padding: 1em;
  word-wrap: break-word;
  white-space: no-wrap;
  overflow: auto;
}

table {
  border-collapse: collapse;
}

td, th {
  border: 1px solid gray;
  padding: .4em;
}

th {
  background-color: #f9f9f9;
  text-align: left;
}

.imageblock.right {
  float: right;
}

.imageblock .title {
  margin-bottom: 2em;
}

hr {
  clear: both;
  border: 0;
  border-bottom: 1px solid #efefef;
  margin: 1em;
}

div.admonitionblock.note {
  background-color: beige;
}

div.admonitionblock td {
  border: 0;
}

div.admonitionblock td:first-child {
  font-weight: bold;
}

.listingblock .title {
  background-color: #efefef;
  margin-bottom: -1em;
  padding: 1em;
}

.red {
  color: white;
  border: 1px solid black;
  padding: .2em;
  font-weight: bold;
  background-color: #cc0000;
}

.red a {
  color: white;
}

@media (max-width: 700px) {
  body {
    display: block;
  }
}


</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="local-users" class="book toc2 toc-left">
<div id="header">
<h1>OliveTin</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">OliveTin documentation</a></span></p><ul class="sectlevel1">
<li><a href="installation.html">Installation Guide</a>
</li>
<li><a href="config.html">Configuration</a>
</li>
<li><a href="reverse-proxies.html">Reverse Proxies</a>
</li>
<li><a href="actions.html">Action execution</a>
</li>
<li><a href="action-customisation.html">Action customisation</a>
</li>
<li><a href="examples.html">Action examples</a>
</li>
<li><a href="args.html">Arguments</a>
</li>
<li><a href="dashboards.html">Dashboards</a>
</li>
<li><a href="entities.html">Entities</a>
</li>
<li><a href="_integrations.html">Integrations</a>
</li>
<li><a href="auth.html">Security</a>
<ul class="sectlevel2">
<li><a href="auth-concepts.html">Concepts</a>
</li>
<li><a href="acls.html">Access Control Lists (Permissions)</a>
</li>
<li><a href="trusted-header.html">Trusted Header Authorization</a>
</li>
<li><a href="jwt.html">JWT Authorization</a>
</li>
<li><a href="jwt-keys.html">JWT with Keys</a>
</li>
<li><a href="jwt-hmac.html">JWT with HMAC</a>
</li>
<li><a href="oauth2.html">OAuth2</a>
</li>
<li><a href="local-users.html"><span class="toc-current">Username &amp; Password</span></a>
</li>
<li><a href="cloudflare-access-tunnels.html">Cloudflare Access &amp; Tunnels</a>
</li>
<li><a href="_gpio_control_on_raspberry_pi.html">GPIO Control on Raspberry Pi</a>
</li>
</ul>
</li>
<li><a href="_advanced_configuration.html">Advanced Configuration</a>
</li>
<li><a href="_reference.html">Reference</a>
</li>
<li><a href="troubleshooting.html">Support &amp; Troubleshooting</a>
</li>
<li><a href="api.html">API</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="local-users"><a class="anchor" href="#local-users"></a><a class="link" href="#local-users">Username &amp; Password</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This page is marked as "earlydoc", which means that it more of a collection of notes and an early draft before this page turns into good documentation later on. It is hoped that this early form of documentation is useful to you, but please understand that most documentation pages are higher quality than this. If you have suggestions or comments, please do get in contact or consider contributing your suggestions to the OliveTin documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>OliveTin supports just basic users defined with a username and password in the config.yaml file. This can be used when you do not want to use a full authentication system like LDAP, OAuth2 or a Reverse Proxy.</p>
</div>
<div class="listingblock">
<div class="title"><code>config.yaml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">authLocalUsers</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">users</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">username</span><span class="pi">:</span> <span class="s">james</span>
      <span class="na">password</span><span class="pi">:</span> <span class="s">$argon2id$v=19$m=65536,t=4,p=6$LnNW4sw+jZfa5Ex3YjfuHQ$vl8pjUJhxNmBxScV4lI3cgAZPkNB1rSrnX6ibgoAP8k</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see from the example above that the config contains a single user called <strong>james</strong>, and the password is hashed using Argon2id. OliveTin provides a utility API to hash passwords using Argon2id which can be useful when you want to create new users. Simply run the following curl command to hash a password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"> curl <span class="nt">-sS</span> <span class="nt">--json</span> <span class="s1">'{"password": "myPassword"}'</span> http://olivetin.example.com:1337/api/PasswordHash
 <span class="sb">```</span>

This will <span class="k">return </span>a output like this, you can <span class="k">then </span>copy and <span class="nb">paste </span>this <span class="nb">hash </span>into your config.yaml file<span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Your password hash is: $argon2id$v=19$m=65536,t=4,p=6$dlWTV1RL04/Nuvxzl94NAg$KsYXvCFE2Eu/jkXi/dbbZM3I/2b2VByTAwRIenUwdJk</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Then simply visit the OliveTin web interface and browse to the login page, eg: http://olivetin.example.com:1337/login

Note: Argon2id is the recommended password hashing algorithm link:https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html[recommebded by OWASP] as of October 2024. There doesn't seem to be a good reason yet to provide configuration options for changing the password hashing algorithm, but if you have a good reason, please open an issue on the GitHub repository.

[#solutions]
== Solutions

OliveTin was designed to be very simple, but sometimes OliveTin can get complex - especially if you are trying to do something where you need to jump between lots of different parts of the documentation!

This section of the docs is designed to bring everything into one place and present a scenario, with a single-page solution.

[#solution-on-git-push]
=== GitOps (run actions on Git Push) ===

A really helpful thing to do with OliveTin is to have it run actions when you push to a Git repository. This is a great way to automate things like running tests, building your project, or deploying your code - this turns OliveTin into a powerful GitOps tool, or even a Continuous Integration tool.

This guide assumes that you are using a self-hosted Git repository, and uses a standard Git `post-receive` hook to trigger OliveTin actions. If you are using a hosted Git service like GitHub, GitLab, or Bitbucket, you will need to check their documentation for how to trigger actions on push.

To set up OliveTin to run actions on Git push, you will need to:

1. Create a new OliveTin action that you want to run on push.
2. Set up a Git `post-receive` hook to trigger the OliveTin action.

==== Create a New OliveTin Action ====

First, you will need to create a new OliveTin action that you want to run when you push to your Git repository. This could be anything you like - for example, running tests, building your project, or deploying your code. The example below is a simple action that echoes a message to the console:

[source,yaml]
.OliveTin `config.yaml`
----
actions:
  - title: Run on Git Push
    id: gitops
    icon: &lt;iconify-icon icon="bi:git"&gt;&lt;/iconify-icon&gt;
    shell: |
        echo "You just pushed commit $COMMIT to git, running action..."
        date
    arguments:
        - name: commit
          type: ascii
----

Note that OliveTin will expose all arguments as environment variables in uppercase as shown in the example above. You can of course use the `{{ commit }}` syntax instead and it will do the same thing.

==== Add a Git hook script ====

The following below assumes that you have a Git repository initialized as a bare repository, at `/opt/myrepo.git`. If you have a different repository location, you will need to adjust the paths accordingly.

First, create a new file at `/opt/myrepo.git/hooks/post-receive` with the following contents:

[source,bash]
.Script: `myrepo.git/hooks/post-receive`
----
#!/bin/bash

read OLDREV NEWREV REFNAME

CHANGED_FILES=$(git diff --name-only $OLDREV $NEWREV)

commit_contains_path() {
        local filename=$1

        if echo "$CHANGED_FILES" | grep -q "$filename"; then
                return 0 # True
        else
                return 1 # False
        fi
}

function run_olivetin_action() {
        local ACTION_NAME=$1

        echo "Requesting OliveTin job $ACTION_NAME"

        OLIVETIN_REQUEST="$(cat &lt;&lt;EOF
{
  "actionId": "$ACTION_NAME",
  "arguments": [
        {
                "name": "commit",
                "value": "$NEWREV"
        }
  ]
}
EOF
)"

        exec curl -sS --json "$OLIVETIN_REQUEST" http://olivetin.example.com:1337/api/StartAction
}

if commit_contains_path "k8s-flux"; then
        run_olivetin_action "ServerConfiguration_Flux"

        exit
fi

if commit_contains_path "alert.rules"; then
        run_olivetin_action "ServerConfiguration_Prom"

        exit
fi

run_olivetin_action "gitops"
----

Make sure you make the script executable, and edit the last line of the script to point to your OliveTin instance.

[source,bash]
----
chmod +x /opt/myrepo.git/hooks/post-receive
----

Now, whenever you push to your Git repository, the `post-receive` hook will trigger the OliveTin action you created. You can see if the action was triggered by pushing to the git repository, and looking for output like this;

----
remote: {"executionTrackingId":"55c7371d-7a67-42a4-87d8-d5677b878186"}
----

This is the `executionTrackingId` of the action that was triggered. You can use this to track the progress of the action in the OliveTin UI.
[#container-control-panel]
=== Container Control Panel

OliveTin is frequently used to create simple container control panels, this is one of the default examples that ships with the standard OliveTin config.yaml.

image::images/solution-container-control-panel.png[]

==== Setup if running inside a container

You can control other containers, when running OliveTin inside a container
itself, however you need to do some extra setup when creating the OliveTin
container.

NOTE: If you want to control Docker from inside a Docker container, you will need to also create the container with `--privileged`. Podman does not have this requirement. If you are getting "permission denied" errors it is probably because OliveTin runs as user UID 1000 by default, which is not allowed by your docker host. Simply run OliveTin with `--user root` as a simple workround. Note that &lt;&lt;no-puid-pgid,PUID and PGID variables will not work&gt;&gt;.

. Pass `/var/run/docker.sock` as a bind mount to the container when creating it, eg:
+
----
docker create --privileged --user root -v /var/run/docker.sock:/var/run/docker.sock ...additional args here...
----
+
Or, using the `docker run` syntax;
+
----
docker run --privileged --user root -v /var/run/docker.sock:/var/run/docker.sock --name OliveTin jamesread/olivetin
----
+
. The official x86_64 docker container comes with the `docker` client pre-installed. If you are using `arm` or and `arm64` container, you will need to add Docker yourself.
+
&lt;&lt;container-dnf,How to install additional packages in the container&gt;&gt;
+
NOTE: The reason that the `arm` and `arm64` containers do not include docker, is that when these images are cross-compiled at build time, it takes FOREVER because we have to emulate arm.

After you have passed the socket into the container (and optionally installed docker), you should be able to setup docker actions like it's shown in the example &lt;&lt;example-control-containers,above&gt;&gt;.



==== Entity file

To build this Container Control dashboard, we use an &lt;&lt;entities,entity&gt;&gt; file that stores and updates produced by `docker ps --format json &gt; /etc/OliveTin/entities/containers.json`

[source,yaml]
.`/etc/OliveTin/entities/containers.json`
----
{"Command":"\"/bin/bash\"","CreatedAt":"2024-02-28 22:33:35 +0000 GMT","ID":"fcf468e18a0e","Image":"fedora","Labels":"maintainer=Clement Verna \u003ccverna@fedoraproject.org\u003e","LocalVolumes":"0","Mounts":"","Names":"minecraft","Networks":"bridge","Ports":"","RunningFor":"3 minutes ago","Size":"0B","State":"created","Status":"Created"}
{"Command":"\"/bin/bash\"","CreatedAt":"2024-02-23 23:18:57 +0000 GMT","ID":"442dd6fe316a","Image":"fedora","Labels":"maintainer=Clement Verna \u003ccverna@fedoraproject.org\u003e","LocalVolumes":"0","Mounts":"","Names":"brave_shirley","Networks":"bridge","Ports":"","RunningFor":"4 days ago","Size":"0B","State":"created","Status":"Created"}
----

You can generate this file yourself the first time, but the `config.yaml` below shows how OliveTin can run the `docker ps` command on startup, and on a schedule to update the file.

==== Configuration

Then use the following configuration file;

[source,yaml]
.`config.yaml`
----
# This config has two actions which are applied to all "container" entities 
# found in the entity file.
#
# Docs: http://localhost/docs.olivetin.app/docs/entities.html
actions:
  - title: Start {{ container.Names }}
    icon: box
    shell: docker start {{ container.Names }}
    entity: container
    trigger: Update container entity file

  - title: Stop {{ container.Names }}
    icon: box
    shell: docker stop {{ container.Names }}
    entity: container
    trigger: Update container entity file

  # This is a hidden action, that is run on startup, and every 5 minutes, and 
  # when the above start/stop commands are run (see the `trigger` property).

  - title: Update container entity file
    shell: 'docker ps -a --format json &gt; /etc/OliveTin/entities/containers.json'
    hidden: true
    execOnStartup: true
    execOnCron: '*/5 * * * *'

# Docs: http://docs.olivetin.app/entities.html
entities:
  - file: /etc/OliveTin/entities/containers.json
    name: container

# The only way to properly use entities, are to use them with a `fieldset` on
# a dashboard.
dashboards:
  # This is the second dashboard.
  - title: My Containers
    contents:
      - title: 'Container {{ container.Names }} ({{ container.Image }})'
        entity: container
        type: fieldset
        contents:
          - type: display
            title: |
              {{ container.RunningFor }} &lt;br /&gt;&lt;br /&gt;&lt;strong&gt;{{ container.State }}&lt;/strong&gt;
          - title: 'Start {{ container.Names }}'
          - title: 'Stop {{ container.Names }}'
----


[#systemd-control-panel]
=== Systemd Control Panel

OliveTin can be used to manage selected systemd units (services) as well. This is powered by OliveTin's powerful &lt;&lt;entities,entity support&gt;&gt;. Here is a screenshot of what that can look like (dark theme preference enabled).

image::images/solution-systemd-control-panel.png[]

NOTE: To control systemd, you will need the root user. If you are running OliveTin systemd service itself, then OliveTin should be configured to run as root. The alternative is to use OliveTin in a container, and use &lt;&lt;action-ssh,SSH&gt;&gt; to connect back to the host (as a user that can manage systemd -usually root). This is not an OliveTin limitation, it's just how systemd security works.

==== Entity file

To build this Systemd Control dashboard, we use an &lt;&lt;entities,entity&gt;&gt; file that stores and updates produced by `systemctl list-units..`, output to a json format, and then filtered with jq (JSON Query). Here is the full command that we will use in our config later;

----
user@host: systemctl list-units -a -o json --no-pager | jq -c 'map(select (.unit | contains ("upsilon", "podman", "boot.mount"))) | .[]'  &gt; /etc/OliveTin/entities/systemd_units.json
----

That command will generate a file (example shown below). Let's break down that long command a little bit to explain what it is doing;

. `systemctl list-units -a -o json --no-pager` - will list units, regardless of status - started, stopped, etc (`-a`), in JSON format, and output the results
. `jq` (JSON Query) will select units from that output that match "upsilon", "podman", "boot.mount", and of course you can change this expression to add your own services.
. The `map()` and `.[]` parts of the expression basically just put those units line by line into the file

[source,json]
.An example generated `/etc/OliveTin/entities/systemd_units.json` file
----
{"unit":"boot.mount","load":"loaded","active":"active","sub":"mounted","description":"/boot"}
{"unit":"podman.service","load":"loaded","active":"inactive","sub":"dead","description":"Podman API Service"}
{"unit":"upsilon-drone.service","load":"loaded","active":"active","sub":"running","description":"upsilon-drone"}
{"unit":"podman.socket","load":"loaded","active":"active","sub":"listening","description":"Podman API Socket"}
----

You can generate this file yourself the first time, but the `config.yaml` below shows how OliveTin can run the `systemctl list-units ...` command on startup, and on a schedule to update the file.

Note that if the file does not exist the first time OliveTin starts up, then OliveTin will will issue an error about not finding the file to monitor it. An easy way around this is to simply restart OliveTin a 2nd time, so that on the 2nd startup it will find the file (because it will be created the first time OliveTin starts up).

==== Configuration

Finally, here is the example configuration file to build the dashboard;

[source,yaml]
.`config.yaml`
----
actions:
  - title: Stop {{ systemd_unit.unit }}
    shell: systemctl stop {{ systemd_unit.unit }}
    icon: &lt;iconify-icon icon="zondicons:hand-stop"&gt;&lt;/iconify-icon&gt;
    entity: systemd_unit
    trigger: Update services file

  - title: Start {{ systemd_unit.unit }}
    shell: systemctl start {{ systemd_unit.unit }}
    icon: &lt;iconify-icon icon="ic:round-directions-run"&gt;&lt;/iconify-icon&gt;
    entity: systemd_unit
    trigger: Update services file

  - title: Update services file
    shell: systemctl list-units -a -o json --no-pager | jq -c 'map(select (.unit | contains ("upsilon", "podman", "boot.mount"))) | .[]'  &gt; /etc/OliveTin/entities/systemd_units.json
    hidden: true
    execOnStartup: true

entities:
  - file: /etc/OliveTin/entities/systemd_units.json
    name: systemd_unit

dashboards:
  - title: My Services
    contents:
      - title: '{{ systemd_unit.description }}'
        type: fieldset
        entity: systemd_unit
        contents:
          - title: 'Status: {{ systemd_unit.sub }}'
            type: display

          - title: Start {{ systemd_unit.unit }}
          - title: Stop {{ systemd_unit.unit }}
----


[#heating-control-panel]
=== Heating Control Panel

This was inspired by a GitHub issue to control heating; https://github.com/OliveTin/OliveTin/issues/73

image::images/dashboard-heating-control-panel.png[]

==== Entity file

To build this, we use an &lt;&lt;entities,entity&gt;&gt; file that stores and updates the status of a heater outside of OliveTin.

[source,yaml]
.`/etc/OliveTin/entities/heating.yaml`
----
- title: Main heater
  temperature: 20 degrees
----

==== Configuration

Then use the following configuration file;

[source,yaml]
.`config.yaml`
----
logLevel: "INFO"

actions:
  - title: Turn heating up
    icon: '&amp;#128316;'
    shell: /opt/heating.sh up

  - title: Turn heating down
    icon: '&amp;#128317;'
    shell: /opt/heating.sh down

entities:
  - file: /etc/OliveTin/entities/heating.yaml
    name: heating

dashboards:
  - title: Heating Control Panel
    contents:
      - title: "{{ heater.title }}"
        entity: heating
        type: fieldset
        contents:
          - type: display
            title: |
              &lt;span class = "icon"&gt;&amp;#127777;&lt;/span&gt; &lt;br /&gt;{{ heating.temperature }}

          - title: Turn heating up
          - title: Turn heating down
----


=== Primitive password protection

It is possible to hadd extremely primitive password protection to OliveTin. This is not at all secure to someone that knows the absolute basics of "view source", but if you just want to keep family members away or add a very primitive layer of "security", there are some members of the community that have found this useful.

This assumes you are running OliveTin as a systemd service, if you are running in a container, jump on the discord server for help how to do this.

. Open `/var/www/olivetin/index.html` in a text editor
. This will be a very long line of code all in one line. Scroll all the way to the end and find that code that says `&lt;/body&gt;`. Just before that code statement, add this code, save and close the file.
+
[source,html]
----
&lt;script src = "custom-webui/password.js"&gt;&lt;/script&gt;
----
You will need to this every time you upgrade OliveTin.
+
. Create the `password.js` using the code below, at `/etc/OliveTin/custom-webui/password.js`.

[source,javascript]
.`password.js`
----
const myPassword = 'sekrit'

const domMain = document.getElementsByTagName('main')[0]
domMain.style.display = 'none'

const domPassword = document.createElement('input')
const domLogin = document.createElement('button')

function checkPassword () {
  if (domPassword.value === myPassword) {
    domMain.style.display = 'block'
    domPassword.remove()
    domLogin.remove()
  } else {
    window.alert('Incorrect password. Please try again.')
  }
}

function setupPasswordForm () {
  domPassword.setAttribute('type', 'password')
  domPassword.addEventListener('keydown', (e) =&gt; {
    if (e.key === 'Enter') {
      checkPassword()
    }
  })

  domLogin.innerText = 'Login'
  domLogin.onclick = checkPassword

  const domHeader = document.querySelector('header')
  domHeader.appendChild(domPassword)
  domHeader.appendChild(domLogin)
}

document.addEventListener('DOMContentLoaded', setupPasswordForm)
----
[#wol]
=== Wake On LAN from a container

This is a simple solution that provides wake on lan capabilities from inside a container. It uses the simple `awake` command to send the magic packet. This can be incredibly helpful if you just need a simple button to click to wake up a machine on your network.

Docker containers will normally use a docker network, which is a separate network from the host network. This means that the container will not be able to send the magic packet to the host network. Therefore, we need to create the container with the `--network host` option, which will allow the container to send the magic packet to the host network (not the docker network).


The container is also created with the `--user root` option, which allows the container to send the magic packet as root. This is necessary because the `awake` command requires root privileges to send the magic packet, and also to install the `awake` command in the container.

Create the container as follows;

```bash
user@host: docker create -u root --network=host --name olivetin_wol -v /etc/OliveTin/:/config ghcr.io/olivetin/olivetin:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create your OliveTin <code>config.yaml</code> file in the <code>/etc/OliveTin/</code> directory on the host, with the following content;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">actions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s">WakeOnLan Server1</span>
    <span class="na">shell</span><span class="pi">:</span> <span class="s">awake A8:5E:45:E4:FF:2A</span>
    <span class="na">icon</span><span class="pi">:</span> <span class="s">ping</span>

  <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s">Install awake on startup</span>
    <span class="na">shell</span><span class="pi">:</span> <span class="s">microdnf install -y awake</span>
    <span class="na">hidden</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">execOnStartup</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">timeout</span><span class="pi">:</span> <span class="s">120</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously adjust the config file with your own MAC addressses, creating new actions to send WOL commands as needed.</p>
</div>
<div class="paragraph">
<p>Then start the container with the following command;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>docker start olivetin_wol</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then visit your OliveTin web interface at <a href="http://yourServer:1337" class="bare">http://yourServer:1337</a> and you should see something that looks like this;</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wol.png" alt="wol">
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="oauth2.html">OAuth2</a> | ↑ Up: <a href="auth.html">Security</a> | ⌂ Home: <a href="index.html">OliveTin documentation</a> | Next: <a href="cloudflare-access-tunnels.html">Cloudflare Access &amp; Tunnels</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-10-18 00:44:30 UTC
</div>
</div>
</body>
</html>