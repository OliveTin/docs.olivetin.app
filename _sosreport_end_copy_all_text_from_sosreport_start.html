<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.21">
<link rel="icon" type="image/png" href="images/icons/OliveTinLogo.png">
<title>OliveTin documentation</title>
<style>
body {
  font-family: sans-serif;
  line-height: 1.5;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-areas: "nav content" "nav footer";
  grid-template-columns: 20em auto;
  grid-template-rows: auto min-content;
  height: 100vh;
  align-items: stretch;
}

a {
  text-decoration: none;
}

a:focus {
  background-color: #bdb76b;
}

#header {
  background-color: #efefef;
  grid-area: nav;
}

#footer {
  grid-area: footer;
  justify-self: center;
  align-self: end;
  padding: 1em;
}

#toc {
  padding: 1em;
}

#toc a {
  color: black;
}

#toc li {
  padding-bottom: .6em;
}

#toc ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

#toc ul ul {
  padding-left: 1.4em;
}

#toctitle {
  font-weight: bold;
  color: black;
}

h1 {
  font-size: 1.4em;
  font-weight: lighter;
  background-color: black;
  padding: .6em;
  margin: 0;
  color: white;
}

#toc a:hover {
  text-decoration: underline;
}

#content {
  background-color: white;
  grid-area: content;
  max-width: 1000px;
  padding: 1em;
  justify-self: center;
}

#content img {
  max-width: 100%;
  vertical-align: middle;
}

pre {
  background-color: #f7f7f8;
  padding: 1em;
  word-wrap: break-word;
  white-space: no-wrap;
  overflow: auto;
}

table {
  border-collapse: collapse;
}

td, th {
  border: 1px solid gray;
  padding: .4em;
}

th {
  background-color: #f9f9f9;
  text-align: left;
}

.imageblock.right {
  float: right;
}

hr {
  clear: both;
  border: 0;
  border-bottom: 1px solid #efefef;
  margin: 1em;
}

div.admonitionblock.note {
  background-color: beige;
}

div.admonitionblock td {
  border: 0;
}

div.admonitionblock td:first-child {
  font-weight: bold;
}

.listingblock .title {
  background-color: #efefef;
  margin-bottom: -1em;
  padding: 1em;
}

@media (max-width: 700px) {
  body {
    display: block;
  }
}

</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_sosreport_end_copy_all_text_from_sosreport_start" class="book toc2 toc-left">
<div id="header">
<h1>OliveTin</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">OliveTin documentation</a></span></p><ul class="sectlevel1">
<li><a href="installation.html">1. Installation Guide</a>
</li>
<li><a href="config.html">2. Configuration</a>
</li>
<li><a href="reverse-proxies.html">3. Reverse Proxies</a>
</li>
<li><a href="actions.html">4. Actions</a>
</li>
<li><a href="action-customisation.html">5. Action customisation</a>
</li>
<li><a href="examples.html">6. Action examples</a>
</li>
<li><a href="args.html">7. Arguments</a>
</li>
<li><a href="dashboards.html">8. Dashboards</a>
</li>
<li><a href="_its_often_useful_to_turn_logging_to_debug_when_trying_to_work_out_authentication_problems.html">It&#8217;s often useful to turn logging to DEBUG when trying to work out authentication problems</a>
</li>
<li><a href="_this_config_has_two_actions_which_are_applied_to_all_container_entities.html">This config has two actions which are applied to all "container" entities </a>
</li>
<li><a href="_found_in_the_entity_file.html">found in the entity file.</a>
</li>
<li><a href="_docs_httpdocs_olivetin_appentities_html.html">Docs: http://docs.olivetin.app/entities.html</a>
</li>
<li><a href="_the_only_way_to_properly_use_entities_are_to_use_them_with_a_fieldset_on.html">The only way to properly use entities, are to use them with a <code>fieldset</code> on</a>
</li>
<li><a href="_a_dashboard.html">a dashboard.</a>
</li>
<li><a href="_build.html">Build:</a>
</li>
<li><a href="_runtime.html">Runtime:</a>
</li>
<li><a href="_config.html">Config:</a>
<ul class="sectlevel2">
<li><a href="_sosreport_end_copy_all_text_from_sosreport_start.html"><span class="toc-current">.1. SOSREPORT END  (copy all text from SOSREPORT START)</span></a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="_sosreport_end_copy_all_text_from_sosreport_start"><a class="anchor" href="#_sosreport_end_copy_all_text_from_sosreport_start"></a><a class="link" href="#_sosreport_end_copy_all_text_from_sosreport_start">1. SOSREPORT END  (copy all text from SOSREPORT START)</a></h3>
<div class="listingblock">
<div class="content">
<pre>You can then copy and paste this text into a GitHub issue, discussion, Discord chat, or wherever else someone might be helping you.

==== How do I generate a sosreport?

OliveTin needs to be able to startup and it's API needs to be functional. Once OliveTin is started, simply browse to: http://myserver:1337/api/sosreport

You should get a simple JSON message saying something like;</pre>
</div>
</div>
<div class="paragraph">
<p>alert: "Your SOS Report has been logged to OliveTin logs."</p>
</div>
<div class="listingblock">
<div class="content">
<pre>If you see this, great! The actual contents of the sosreport are not returned to your browser for security reasons (guests could get info about your installation, etc).

To find the sosreport depends on how you are running OliveTin, if you are running in a container, then try `docker logs olivetin` (where "olivetin" is your container name). If you are running using systemd, then try `journalctl -eu OliveTin`.

==== What if I cannot even get to the OliveTin API?

OliveTin's web interface doesn't need to be working to get a sosreport (as the web interface and the API are separate). However, if OliveTin won't even startup, or you cannot seem to get to the API, then sadly a sosreport can't help you. Please do specify that when you ask for help.

=== Exit code 127

Exit code 127 on Linux typically means "command not found". This can be the
case when you need to install command in a container image for example.

[#no-puid-pgid]
=== PUID and PGID support

The OliveTin container image does not use the PUID and PGID convention to specify which user the container should run as - this is a convention that was popularized by linuxserver.io, because their container images use supervisord. Instead, simply use the `--user` argument when defining the container, to change the user OliveTin runs as.

* link:https://docs.linuxserver.io/general/understanding-puid-and-pgid[LSIO documentation for PUID and PGID, that says that `--user` is the same thing]

An example is shown below;

[source,shell]
.Using --user</pre>
</div>
</div>
<div class="paragraph">
<p>user@host: docker create --name olivetin -p 1337:1337 -v /etc/OliveTin/:/config:ro docker.io/jamesread/olivetin --user container:container
user@host: docker start olivetin</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The following are common errors;

[#err-fetch-buttons]
=== Error Getting Buttons

This is most often caused by not being able to get to /api/ properly - normally due to a bad proxy config, or your network was disconnected.

[#err-fetch-webui-settings]
=== Error Fetching WebUI Settings

This is a less common issue, but it means that the main web HTML has loaded, but it could not get http://yourserver:1337/webUiSettings.json - most likely because of a 404 (Not Found) or JSON parse issue. You can see the exact reason if your browser as Web Developer Tools - look in the console. Firefox and Chrome both have great web developer tools, that can normally be opened with the F12 key, or from the developer tools menu.

The most common cause of this issue is a broken reverse proxy configuration. To debug this, browse to http://yourserver:1337/webUiSettings.json and adjust your reverse proxy configuration until the file loads properly. See &lt;&lt;reverse-proxies&gt;&gt; for common configuration instructions.

An uncommon cause of this issue is if you are self-hosting the HTML outside of OliveTin. This is supported, but it means you will need to write the webUiSettings.json file manually. This is currently not documented as very very few people really need or want to do this. It's very uncommon at the moment to self host the HTML outside of the OliveTin main server. Jump on the discord to discuss this if you want to do this, see &lt;&lt;support&gt;&gt;.

[#err-js-modules-not-supported]
=== Error: JS Modules not supported

This is most likely because you are using a very old browser, or have some Javascript disabled.

This page describes the compatible browsers for Javascript modules; https://caniuse.com/es6-module .

There is no workaround for this apart from updating your browser / using a better browser, as OliveTin wants to be a progressive web app and doesn't intend to support browsers without module support.

[#api]
== API

=== OliveTin API Overview
This section of the documentation is intended for developers, and those who want to hack around with OliveTin and extend it. This page provides a few pointers to get started.

**Short version**: http://olivetinServer:1337/api for the REST API. link:http://docs.olivetin.app/api/[Swagger] documents the API.

**Longer version**: The OliveTin API is formally defined using the Protobuf IDL, which generates gRPC stubs, as well as a REST Gateway.

The REST API gateway is used by the WebUI, and you can use it too by default - it is exposed at "/api" by default.

The gRPC API only listens on localhost default, but it can be set to listen publicly. See &lt;&lt;network-ports, the network ports documentation&gt;&gt; for a better description of how the APIs are exposed. Most people do not need to use the gRPC API. The .proto file for the gRPC API is located at the root of the OliveTin Git repository; https://github.com/OliveTin/OliveTin/blob/main/OliveTin.proto[OliveTin.proto].

==== Links

* link:http://docs.olivetin.app/api/[Swagger UI for OliveTin API]
* link:http://docs.olivetin.app/api/OliveTin.openapi.json[OpenAPI JSON Definition]
* link:https://github.com/OliveTin/OliveTin/blob/main/OliveTin.proto[The OliveTin Protobuf file].

Please do talk to the developers on Discord if you'd like help using the API, or you're thinking about building something interesting using the API!

[#api-start-action]
=== Starting Actions from the API


There are several variants of this API call available which might be easier for scripts (or humans) to work with!

.Webhook/API reference table
[%header]
|======================================================
| Function                     | HTTP Method | Request Type (How to select an action)             | Response Type
| `StartAction`                | POST        | &lt;&lt;api-request-obj,OliveTin request object&gt;&gt;        | &lt;&lt;api-response-trackingid,Execution Tracking ID&gt;&gt;
| `StartActionByGet`           | GET         | &lt;&lt;api-request-idurl,Action ID in the URL&gt;&gt;         | &lt;&lt;api-response-trackingid,Execution Tracking ID&gt;&gt;
| `StartActionAndWait`         | POST        | &lt;&lt;api-request-obj,OliveTin request object&gt;&gt;        | &lt;&lt;api-response-logentry,Log Entry (waits for the action to finish)&gt;&gt;
| `StartActionByGetAndWait`    | GET         | &lt;&lt;api-request-idurl,Action ID in the URL&gt;&gt;         | &lt;&lt;api-response-logentry,Log Entry (waits for the action to finish)&gt;&gt;
|======================================================


[#api-request-idurl]
==== Request type: Action ID in the URL

Used by:

* `StartActionByGet`
* `StartActionByGetAndWait`

If you are trying to integrate OliveTin with your own scripts or processes, it's probably easiest to start actions by using an ID directly in the URL, &lt;&lt;api-eg-startIdUrl,see the example&gt;&gt;.

[#api-request-obj]
==== Request type: OliveTin request object

Used by:

* `StartAction`
* `StartActionAndWait`

[source,json]
.OliveTin request object structure</pre>
</div>
</div>
<div class="paragraph">
<p>{
  "actionId": "string",
  "arguments": [
    {
      "name": "string",
      "value": "string"
    }
  ],
  "uniqueTrackingId": "string"
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>To find your Action ID, and understand how Action IDs work, see the &lt;&lt;action-id,Action ID&gt;&gt; documentation

If you need more control over the execution, then the only other option is to submit a `OliveTin reqjest object`, which is just a very simple JSON structure like this;

[source,json]</pre>
</div>
</div>
<div class="paragraph">
<p>{
    "actionId": "Generate cryptocurrency",
    "arguments": [],
    "uniqueTrackingId": "my-tracking-id",
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>More detailed examples can be seen below.

[#api-response-trackingid]
==== Response type: Execution Tracking ID

Used by:

* `StartAction`
* `StartActionByGet`

.Example Execution Tracking ID response
[source,json]</pre>
</div>
</div>
<div class="paragraph">
<p>{"executionTrackingId":"5bb4860c-bbd0-4bc9-a7d6-42240551500c"}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[#api-response-logentry]
==== Response type: LogEntry

Used by:

* `StartActionAndWait`
* `StartActionByGetAndWait`

.Example log entry
[source,json]</pre>
</div>
</div>
<div class="paragraph">
<p>{
    "logEntry": {
        "datetimeStarted": "2024-02-27 14:14:49",
        "actionTitle": "Restart httpd on server1",
        "stdout": "",
        "stderr": "",
        "timedOut": true,
        "exitCode": -1,
        "user": "",
        "userClass": "",
        "actionIcon": "&#128260;",
        "tags": [</p>
</div>
<div class="literalblock">
<div class="content">
<pre>        ],
        "executionTrackingId": "b04b1e90-d457-4158-b7dc-da9e81f21568",
        "datetimeFinished": "2024-02-27 14:14:52",
        "actionId": "restart_httpd",
        "executionStarted": true,
        "executionFinished": true,
        "blocked": false
    }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[#api-eg-startIdUrl]
==== Example API call; Start an action by ID in the URL

.curl</pre>
</div>
</div>
<div class="paragraph">
<p>user@host: curl <a href="http://olivetin.example.com/api/StartActionByGet/pingGithub" class="bare">http://olivetin.example.com/api/StartActionByGet/pingGithub</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre>The corresponding config.yaml would look like this;

[source,yaml]</pre>
</div>
</div>
<div class="paragraph">
<p>actions:
  - title: Ping GitHub.com
    id: pingGithub
    shell: ping github.com -c 1</p>
</div>
<div class="listingblock">
<div class="content">
<pre>IDs are used by these API calls, as you probably want the interface to display a human-readable title, whereas the API call doesn't want to have spaces or punctuation.

==== Example API call: Start an action using `StartAction`

[source,bash]
.curl</pre>
</div>
</div>
<div class="paragraph">
<p>user@host: curl -X POST "http://olivetin.webapps.teratan.lan/api/StartAction" -d '{"actionId": "nuclear_reactor_shutdown"}'</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[source,powershell]
.Powershell</pre>
</div>
</div>
<div class="paragraph">
<p>PS C:\Users\xcons&gt; $json = '{"actionId": "deploy_attack_gnomes"}'
PS C:\Users\xcons&gt; Invoke-RestMethod -Method "Post" -Uri "http://olivetinServer:1337/api/StartAction" -Body $json</p>
</div>
<div class="listingblock">
<div class="content">
<pre>==== Example API call: Start an action using `StartAction` with arguments

[source,bash]
.curl</pre>
</div>
</div>
<div class="paragraph">
<p>user:host: curl -X POST 'http://olivetin.example.com/api/StartAction' -d '{"actionId": "Ping_host", "arguments": [{"name": "host", "value": "example.com"},{"name": "count", "value": "1"}]}'</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=== Misc API calls

==== Example API call: Get the dashboard buttons ("components")

.curl</pre>
</div>
</div>
<div class="paragraph">
<p>user@host: curl <a href="http://olivetinServer:1337/api/GetDashboardComponents" class="bare">http://olivetinServer:1337/api/GetDashboardComponents</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre>==== Example API call: readyz Healthcheck

This is useful for configuring healthchecks in docker containers, or on Kubernetes.

.curl</pre>
</div>
</div>
<div class="paragraph">
<p>user@host: curl <a href="http://olivetinServer:1337/api/readyz" class="bare">http://olivetinServer:1337/api/readyz</a>
{"status": "ok"}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The response will always be "status: ok" to indicate that the API is up, or it will timeout.</pre>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>↑ Up: <a href="_config.html">Config:</a> | ⌂ Home: <a href="index.html">OliveTin documentation</a></p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-03-05 22:54:39 UTC
</div>
</div>
</body>
</html>