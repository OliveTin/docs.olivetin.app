[#action-customisation]
== Action customisation

=== Arguments 

==== Important Safety Warning

Actions/commands that OliveTin runs, without arguments, are generally quite safe - only that command can be run, without modifications. However, many users need the flexibility to set options on that command - normally called command line arguments. 

OliveTin now supports this feature, but there is a element of risk. For example, if your command is `echo {{ message }}`, and you allow your users to set `{{ message }}` to the value `"" && rm -rf /` , then you've got real problems. For this reason, OliveTin tries to give you useful ways to restrict what users are allowed to enter - with **argument types**. 

However, here are some important rules to try and follow with argument types;

* Use the most restrictive argument types when possible - `ascii` and `int`. This will stop users entering argument values that might be used dangerously, but it's not foolproof. For example, if you have a command like `createSnapshot.sh --count {{ snapshotCount }}`, and set `snapshotCount` to `int`, then at least users will only be able to enter integer numbers. However, nothing stops them entering crazy values like 9999. 
* Don't give access to actions with arguments to people you don't trust. Please don't ever put your OliveTin install on the public internet! 

==== Argument types

A full list of argument types are below;

|===
| Type                        | Allowed values
| very_dangerous_raw_string   | Any thing. This is incredibly dangerous, as effectively people can type anything they like, including executing additional commands beyond what you specify. Absolutely should not be used unless your OliveTin instance can only be used by people you trust entirely.
| int                         | Any number, made up of the characters 0 to 9. Negative numbers are not supported.
| ascii                       | a-z (case insensitive), 0-9, but no spaces or punctuation
| ascii_identifier            | Like a DNS name, a-Z (case insensitive), 0-0, `-`, `.`, and `_`. 
| ascii_sentence              | a-z (case insensitive), 0-9, with spaces, `.` and `,`. 
|===


=== Hello World - Your first command with arguments

Many times you need to customize how an action/shell command is run, with arguments. For example;

----
echo "Hello world"
----

In the example above, `Hello world` is an argument passed to the `echo` command. OliveTin allows you to add pre-defined, and free-text arguments to commands in this way. Below is the OliveTin version of the `echo` command shown above;

----
actions:
  - title: echo a message
    icon: smile
    shell: echo {{ message }}
    arguments:
      - name: message
        type: ascii_sentence
----

This will give you a normal button, like this;

image::images/args1.png[]

However, when you click on it, you'll get a prompt to enter arguments, like this;

image::images/args2.png[]

You'll see that the type is set to `ascii_identifier`. This applies fairly safe
input validation to arguments, so that only a-z, 0-9, spaces and .'s are allowed. 

When you start the action, and it's finished, go to the "logs" view to view the output of the command we've just run.

image::images/args3.png[]

==== Hello or goodbye? Restricting choices

Predefined choices are normally the safest type of arguments, because users are limited to only enter values that you specify. 

----
actions:
  - title: echo a message
    icon: smile
    shell: echo "{{ message }}"
    arguments:
      - name: message
        choices:
          - title: Hello
            value: Hello there!

          - title: Goodbye
            value: Aww, goodbye. :-( 
----

Note that when predefined choices are used, the argument type is ignored.

=== Icons

You can specify any HTML for an icon. It's a popular choice to use Unicode
icons because they are extremely fast to load and there are a lot of them.

.Examples of icons in OliveTin
image::images/exampleIcons.png[]

==== Unicode icons ("emoji")

For example on the link:https://unicode-table.com/en/emoji/[here is a list of
"Eomji" in unicode]. If you find "link:https://unicode-table.com/en/1F60E/[Smiling face with sunglasses]" you can click 
on it to see it's "HTML-code". In OliveTin, you'd setup the icon like this;

----
actions:
  - title: Unicode (emoji) icon
    icon: "&#128526;"
    shell: echo "You are awesome"
----

==== Full HTML icons (`<img src ...`)
You can also specify the full HTML for an image, like;

----
actions:
    - title: HTML (jpg/png/etc) icon
      icon: '<img src = "https://www.docker.com/sites/default/files/d8/2019-07/vertical-logo-monochromatic.png" width = "48px"/>'
      shell: docker ps
----

NOTE: This full HTML thing is very customizable, but easier options will
probably be added in the future as well. 

////
=== CSS styles

OliveTin allows you to write any CSS style rules directly on a single action.
This is both pretty powerful if you want an action to have a particular style,
but it does require understanding that you are writing your code - and can
break things! Be careful!

A tutorial on how to use CSS can easily be found online, but here are some
examples;

==== Example: Bold & Purple action

----
- actions:
    - title: My special action
      css:
        background-color: purple
        font-weight: bold
      shell: echo "I like purple"
----
////

=== Timeouts

By default, actions in OliveTin have a 3 second timeout. This means that
OliveTin will kill the action if it is running for too long. 

You can set your own timeouts like this;

----
- actions:
  - title: My special action
    shell: sleep 5
    timeout: 10
----

NOTE: Allowing commands to run for infinity just doesn't seem to make sense, or
at least is probably a bad case for OliveTin. Therefore, if you set a timeout
*less than 3 seconds*, OliveTin will overwrite your Timeout and default to 3
seconds. If you think you have a use case where a shorter (or infinite) timeout
makes sense, please open an issue and let's discuss.

=== Run as different users

OliveTin does not *need* to run as root. It does not request any special
permissions from the operating system that require root (as long as you run on
ports above 1024, and it can read/write it's configuration). So, you can run as
any non-root user if you wish.

However, it is very convenient to run as root, as many users will need to run 
actions and jobs that do require root permissions. 

There are no ways in OliveTin to specify which user runs an action, because the
Linux OS has several great ways to do this already, and adding support for it
in OliveTin just adds bloat when there are perfectly good ways that already
exist.

==== EG: Using sudo;

----
actions:
  - title: Run echo as a different user
    shell: sudo -u bob echo "I am Bob."
----

If you are worried about security, you could run OliveTin as a non-privileged
user, and use sudo rules to control what it can and cannot do. 
