<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.21">
<link rel="icon" type="image/png" href="images/icons/OliveTinLogo.png">
<title>OliveTin documentation</title>
<style>
body {
  font-family: sans-serif;
  line-height: 1.5;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-areas: "nav content" "nav footer";
  grid-template-columns: 20em auto;
  grid-template-rows: auto min-content;
  height: 100vh;
  align-items: stretch;
}

a {
  text-decoration: none;
}

a:focus {
  background-color: #bdb76b;
}

#header {
  background-color: #efefef;
  grid-area: nav;
}

#footer {
  grid-area: footer;
  justify-self: center;
  align-self: end;
  padding: 1em;
}

#toc {
  padding: 1em;
}

#toc a {
  color: black;
}

#toc li {
  padding-bottom: .6em;
}

#toc ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

#toc ul ul {
  padding-left: 1.4em;
}

#toctitle {
  font-weight: bold;
  color: black;
}

h1 {
  font-size: 1.4em;
  font-weight: lighter;
  background-color: black;
  padding: .6em;
  margin: 0;
  color: white;
}

#toc a:hover {
  text-decoration: underline;
}

#content {
  background-color: white;
  grid-area: content;
  max-width: 1000px;
  padding: 1em;
  justify-self: center;
}

#content img {
  max-width: 100%;
  vertical-align: middle;
}

pre {
  background-color: #f7f7f8;
  padding: 1em;
  word-wrap: break-word;
  white-space: no-wrap;
  overflow: auto;
}

table {
  border-collapse: collapse;
}

td, th {
  border: 1px solid gray;
  padding: .4em;
}

th {
  background-color: #f9f9f9;
  text-align: left;
}

.imageblock.right {
  float: right;
}

hr {
  clear: both;
  border: 0;
  border-bottom: 1px solid #efefef;
  margin: 1em;
}

div.admonitionblock.note {
  background-color: beige;
}

div.admonitionblock td {
  border: 0;
}

div.admonitionblock td:first-child {
  font-weight: bold;
}

.listingblock .title {
  background-color: #efefef;
  margin-bottom: -1em;
  padding: 1em;
}

@media (max-width: 700px) {
  body {
    display: block;
  }
}

</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="container-control-panel" class="book toc2 toc-left">
<div id="header">
<h1>OliveTin</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">OliveTin documentation</a></span></p><ul class="sectlevel1">
<li><a href="installation.html">1. Installation Guide</a>
</li>
<li><a href="config.html">2. Configuration</a>
</li>
<li><a href="reverse-proxies.html">3. Reverse Proxies</a>
</li>
<li><a href="actions.html">4. Actions</a>
</li>
<li><a href="action-customisation.html">5. Action customisation</a>
</li>
<li><a href="examples.html">6. Action examples</a>
</li>
<li><a href="args.html">7. Arguments</a>
</li>
<li><a href="dashboards.html">8. Dashboards</a>
</li>
<li><a href="entities.html">9. Entities</a>
</li>
<li><a href="_advanced_configuration.html">10. Advanced Configuration</a>
</li>
<li><a href="auth.html">11. Authentication &amp; Authorization</a>
</li>
<li><a href="solutions.html">12. Solutions</a>
<ul class="sectlevel2">
<li><a href="container-control-panel.html"><span class="toc-current">12.1. Container Control Panel</span></a>
</li>
<li><a href="heating-control-panel.html">12.2. Heating Control Panel</a>
</li>
<li><a href="_gpio_control_on_raspberry_pi.html">12.3. GPIO Control on Raspberry Pi</a>
</li>
</ul>
</li>
<li><a href="_reference.html">13. Reference</a>
</li>
<li><a href="troubleshooting.html">14. Support &amp; Troubleshooting</a>
</li>
<li><a href="api.html">15. API</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="container-control-panel"><a class="anchor" href="#container-control-panel"></a><a class="link" href="#container-control-panel">12.1. Container Control Panel</a></h3>
<div class="paragraph">
<p>OliveTin is frequently used to create simple container control panels, this is one of the default examples that ships with the standard OliveTin config.yaml.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/solution-container-control-panel.png" alt="solution container control panel">
</div>
</div>
<div class="sect3">
<h4 id="_setup_if_running_inside_a_container_2"><a class="anchor" href="#_setup_if_running_inside_a_container_2"></a><a class="link" href="#_setup_if_running_inside_a_container_2">12.1.1. Setup if running inside a container</a></h4>
<div class="paragraph">
<p>You can control other containers, when running OliveTin inside a container
itself, however you need to do some extra setup when creating the OliveTin
container.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you want to control Docker from inside a Docker container, you will need to also create the container with <code>--privileged</code>. Podman does not have this requirement. If you are getting "permission denied" errors it is probably because OliveTin runs as user UID 1000 by default, which is not allowed by your docker host. Simply run OliveTin with <code>--user root</code> as a simple workround. Note that <a href="no-puid-pgid.html">PUID and PGID variables will not work</a>.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pass <code>/var/run/docker.sock</code> as a bind mount to the container when creating it, eg:</p>
<div class="listingblock">
<div class="content">
<pre>docker create --privileged --user root -v /var/run/docker.sock:/var/run/docker.sock ...additional args here...</pre>
</div>
</div>
<div class="paragraph">
<p>Or, using the <code>docker run</code> syntax;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker run --privileged --user root -v /var/run/docker.sock:/var/run/docker.sock --name OliveTin jamesread/olivetin</pre>
</div>
</div>
</li>
<li>
<p>The official x86_64 docker container comes with the <code>docker</code> client pre-installed. If you are using <code>arm</code> or and <code>arm64</code> container, you will need to add Docker yourself.</p>
<div class="paragraph">
<p><a href="container-dnf.html">How to install additional packages in the container</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The reason that the <code>arm</code> and <code>arm64</code> containers do not container docker, is that when these images are cross-compiled at build time, it takes FOREVER because we have to emulate arm.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>After you have passed the socket into the container (and optionally installed docker), you should be able to setup docker actions like it&#8217;s shown in the example <a href="action-container-control.html#example-control-containers">above</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_entity_file"><a class="anchor" href="#_entity_file"></a><a class="link" href="#_entity_file">12.1.2. Entity file</a></h4>
<div class="paragraph">
<p>To build this Container Control dashboard, we use an <a href="entities.html">entity</a> file that stores and updates produced by <code>docker ps --format json &gt; /etc/OliveTin/entities/containers.json</code></p>
</div>
<div class="listingblock">
<div class="title"><code>/etc/OliveTin/entities/containers.json</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">{</span><span class="s2">"</span><span class="s">Command"</span><span class="pi">:</span><span class="s2">"</span><span class="se">\"</span><span class="s">/bin/bash</span><span class="se">\"</span><span class="s">"</span><span class="pi">,</span><span class="s2">"</span><span class="s">CreatedAt"</span><span class="pi">:</span><span class="s2">"</span><span class="s">2024-02-28</span><span class="nv"> </span><span class="s">22:33:35</span><span class="nv"> </span><span class="s">+0000</span><span class="nv"> </span><span class="s">GMT"</span><span class="pi">,</span><span class="s2">"</span><span class="s">ID"</span><span class="pi">:</span><span class="s2">"</span><span class="s">fcf468e18a0e"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Image"</span><span class="pi">:</span><span class="s2">"</span><span class="s">fedora"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Labels"</span><span class="pi">:</span><span class="s2">"</span><span class="s">maintainer=Clement</span><span class="nv"> </span><span class="s">Verna</span><span class="nv"> </span><span class="se">\u003c</span><span class="s">cverna@fedoraproject.org</span><span class="se">\u003e</span><span class="s">"</span><span class="pi">,</span><span class="s2">"</span><span class="s">LocalVolumes"</span><span class="pi">:</span><span class="s2">"</span><span class="s">0"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Mounts"</span><span class="pi">:</span><span class="s2">"</span><span class="s">"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Names"</span><span class="pi">:</span><span class="s2">"</span><span class="s">minecraft"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Networks"</span><span class="pi">:</span><span class="s2">"</span><span class="s">bridge"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Ports"</span><span class="pi">:</span><span class="s2">"</span><span class="s">"</span><span class="pi">,</span><span class="s2">"</span><span class="s">RunningFor"</span><span class="pi">:</span><span class="s2">"</span><span class="s">3</span><span class="nv"> </span><span class="s">minutes</span><span class="nv"> </span><span class="s">ago"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Size"</span><span class="pi">:</span><span class="s2">"</span><span class="s">0B"</span><span class="pi">,</span><span class="s2">"</span><span class="s">State"</span><span class="pi">:</span><span class="s2">"</span><span class="s">created"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Status"</span><span class="pi">:</span><span class="s2">"</span><span class="s">Created"</span><span class="pi">}</span>
<span class="pi">{</span><span class="s2">"</span><span class="s">Command"</span><span class="pi">:</span><span class="s2">"</span><span class="se">\"</span><span class="s">/bin/bash</span><span class="se">\"</span><span class="s">"</span><span class="pi">,</span><span class="s2">"</span><span class="s">CreatedAt"</span><span class="pi">:</span><span class="s2">"</span><span class="s">2024-02-23</span><span class="nv"> </span><span class="s">23:18:57</span><span class="nv"> </span><span class="s">+0000</span><span class="nv"> </span><span class="s">GMT"</span><span class="pi">,</span><span class="s2">"</span><span class="s">ID"</span><span class="pi">:</span><span class="s2">"</span><span class="s">442dd6fe316a"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Image"</span><span class="pi">:</span><span class="s2">"</span><span class="s">fedora"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Labels"</span><span class="pi">:</span><span class="s2">"</span><span class="s">maintainer=Clement</span><span class="nv"> </span><span class="s">Verna</span><span class="nv"> </span><span class="se">\u003c</span><span class="s">cverna@fedoraproject.org</span><span class="se">\u003e</span><span class="s">"</span><span class="pi">,</span><span class="s2">"</span><span class="s">LocalVolumes"</span><span class="pi">:</span><span class="s2">"</span><span class="s">0"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Mounts"</span><span class="pi">:</span><span class="s2">"</span><span class="s">"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Names"</span><span class="pi">:</span><span class="s2">"</span><span class="s">brave_shirley"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Networks"</span><span class="pi">:</span><span class="s2">"</span><span class="s">bridge"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Ports"</span><span class="pi">:</span><span class="s2">"</span><span class="s">"</span><span class="pi">,</span><span class="s2">"</span><span class="s">RunningFor"</span><span class="pi">:</span><span class="s2">"</span><span class="s">4</span><span class="nv"> </span><span class="s">days</span><span class="nv"> </span><span class="s">ago"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Size"</span><span class="pi">:</span><span class="s2">"</span><span class="s">0B"</span><span class="pi">,</span><span class="s2">"</span><span class="s">State"</span><span class="pi">:</span><span class="s2">"</span><span class="s">created"</span><span class="pi">,</span><span class="s2">"</span><span class="s">Status"</span><span class="pi">:</span><span class="s2">"</span><span class="s">Created"</span><span class="pi">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can generate this file yourself the first time, but the <code>config.yaml</code> below shows how OliveTin can run the <code>docker ps</code> command on startup, and on a schedule to update the file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration"><a class="anchor" href="#_configuration"></a><a class="link" href="#_configuration">12.1.3. Configuration</a></h4>
<div class="paragraph">
<p>Then use the following configuration file;</p>
</div>
<div class="listingblock">
<div class="title"><code>config.yaml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># This config has two actions which are applied to all "container" entities </span>
<span class="c1"># found in the entity file.</span>
<span class="c1">#</span>
<span class="c1"># Docs: http://localhost/docs.olivetin.app/docs/entities.html</span>
<span class="na">actions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s">Start {{ container.Names }}</span>
    <span class="na">icon</span><span class="pi">:</span> <span class="s">box</span>
    <span class="na">shell</span><span class="pi">:</span> <span class="s">docker start {{ container.Names }}</span>
    <span class="na">entity</span><span class="pi">:</span> <span class="s">container</span>
    <span class="na">trigger</span><span class="pi">:</span> <span class="s">Update container entity file</span>

  <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s">Stop {{ container.Names }}</span>
    <span class="na">icon</span><span class="pi">:</span> <span class="s">box</span>
    <span class="na">shell</span><span class="pi">:</span> <span class="s">docker stop {{ container.Names }}</span>
    <span class="na">entity</span><span class="pi">:</span> <span class="s">container</span>
    <span class="na">trigger</span><span class="pi">:</span> <span class="s">Update container entity file</span>

  <span class="c1"># This is a hidden action, that is run on startup, and every 5 minutes, and </span>
  <span class="c1"># when the above start/stop commands are run (see the `trigger` property).</span>

  <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s">Update container entity file</span>
    <span class="na">shell</span><span class="pi">:</span> <span class="s1">'</span><span class="s">docker</span><span class="nv"> </span><span class="s">ps</span><span class="nv"> </span><span class="s">-a</span><span class="nv"> </span><span class="s">--format</span><span class="nv"> </span><span class="s">json</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">/etc/OliveTin/entities/containers.json'</span>
    <span class="na">hidden</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">execOnStartup</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">execOnCron</span><span class="pi">:</span> <span class="s1">'</span><span class="s">*/5</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*'</span>

<span class="c1"># Docs: http://docs.olivetin.app/entities.html</span>
<span class="na">entities</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">file</span><span class="pi">:</span> <span class="s">/etc/OliveTin/entities/containers.json</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">container</span>

<span class="c1"># The only way to properly use entities, are to use them with a `fieldset` on</span>
<span class="c1"># a dashboard.</span>
<span class="na">dashboards</span><span class="pi">:</span>
  <span class="c1"># This is the second dashboard.</span>
  <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s">My Containers</span>
    <span class="na">contents</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Container</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">container.Names</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">({{</span><span class="nv"> </span><span class="s">container.Image</span><span class="nv"> </span><span class="s">}})'</span>
        <span class="na">entity</span><span class="pi">:</span> <span class="s">container</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">fieldset</span>
        <span class="na">contents</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">display</span>
            <span class="na">title</span><span class="pi">:</span> <span class="pi">|</span>
              <span class="s">{{ container.RunningFor }} &lt;br /&gt;&lt;br /&gt;&lt;strong&gt;{{ container.State }}&lt;/strong&gt;</span>
          <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Start</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">container.Names</span><span class="nv"> </span><span class="s">}}'</span>
          <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Stop</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">container.Names</span><span class="nv"> </span><span class="s">}}'</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>↑ Up: <a href="solutions.html">Solutions</a> | ⌂ Home: <a href="index.html">OliveTin documentation</a> | Next: <a href="heating-control-panel.html">Heating Control Panel</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-02-29 22:18:26 UTC
</div>
</div>
</body>
</html>