<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<link rel="icon" type="image/png" href="images/icons/OliveTinLogo.png">
<title>OliveTin documentation</title>
<style>
body {
  font-family: sans-serif;
  line-height: 1.5;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-areas: "nav content" "nav footer";
  grid-template-columns: 20em auto;
  grid-template-rows: auto min-content;
  height: 100vh;
  align-items: stretch;
}

a {
  text-decoration: none;
}

a:focus, #toc a:focus {
  background-color: black;
  color: white;
}

#header {
  background-color: #efefef;
  grid-area: nav;
}

#footer {
  grid-area: footer;
  justify-self: center;
  align-self: end;
  padding: 1em;
}

#toc {
  padding: 1em;
}

#toc a {
  color: black;
}

#toc li {
  padding-bottom: .6em;
}

#toc ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

#toc ul ul {
  padding-left: 1.4em;
}

#toctitle {
  font-weight: bold;
  color: black;
}

h1 {
  font-size: 1.4em;
  font-weight: lighter;
  background-color: black;
  padding: .6em;
  margin: 0;
  color: white;
}

#toc a:hover {
  text-decoration: underline;
}

#content {
  background-color: white;
  grid-area: content;
  max-width: 1000px;
  padding: 1em;
  justify-self: center;
}

#content img {
  max-width: 100%;
  vertical-align: middle;
}

code {
  background-color: #f7f7f8;
}

pre {
  background-color: #f7f7f8;
  padding: 1em;
  word-wrap: break-word;
  white-space: no-wrap;
  overflow: auto;
}

table {
  border-collapse: collapse;
}

td, th {
  border: 1px solid gray;
  padding: .4em;
}

th {
  background-color: #f9f9f9;
  text-align: left;
}

.imageblock.right {
  float: right;
}

.imageblock .title {
  margin-bottom: 2em;
}

hr {
  clear: both;
  border: 0;
  border-bottom: 1px solid #efefef;
  margin: 1em;
}

div.admonitionblock.note {
  background-color: beige;
}

div.admonitionblock td {
  border: 0;
}

div.admonitionblock td:first-child {
  font-weight: bold;
}

.listingblock .title {
  background-color: #efefef;
  margin-bottom: -1em;
  padding: 1em;
}

.red {
  color: white;
  border: 1px solid black;
  padding: .2em;
  font-weight: bold;
  background-color: #cc0000;
}

.red a {
  color: white;
}

@media (max-width: 700px) {
  body {
    display: block;
  }
}


</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="jwt-hmac" class="book toc2 toc-left">
<div id="header">
<h1>OliveTin</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">OliveTin documentation</a></span></p><ul class="sectlevel1">
<li><a href="installation.html">Installation Guide</a>
</li>
<li><a href="config.html">Configuration</a>
</li>
<li><a href="reverse-proxies.html">Reverse Proxies</a>
</li>
<li><a href="actions.html">Action execution</a>
</li>
<li><a href="action-customisation.html">Action customisation</a>
</li>
<li><a href="examples.html">Action examples</a>
</li>
<li><a href="args.html">Arguments</a>
</li>
<li><a href="dashboards.html">Dashboards</a>
</li>
<li><a href="entities.html">Entities</a>
</li>
<li><a href="auth.html">Security</a>
<ul class="sectlevel2">
<li><a href="auth-concepts.html">Concepts</a>
</li>
<li><a href="trusted-header.html">Trusted Header Authorization</a>
</li>
<li><a href="jwt.html">JWT Authorization</a>
</li>
<li><a href="jwt-keys.html">JWT with Keys</a>
</li>
<li><a href="jwt-hmac.html"><span class="toc-current">JWT with HMAC</span></a>
</li>
<li><a href="acls.html">Permissions &amp; Access Control</a>
</li>
</ul>
</li>
<li><a href="solutions.html">Solutions</a>
</li>
<li><a href="_advanced_configuration.html">Advanced Configuration</a>
</li>
<li><a href="_reference.html">Reference</a>
</li>
<li><a href="troubleshooting.html">Support &amp; Troubleshooting</a>
</li>
<li><a href="api.html">API</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="jwt-hmac"><a class="anchor" href="#jwt-hmac"></a><a class="link" href="#jwt-hmac">JWT with HMAC</a></h3>
<div class="paragraph">
<p>You need to know your JWT <strong>Cookie Name</strong> and <strong>Hash Secret</strong>. Whatever tool you are using to authenticate users will probably have instructions on how to find this.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.organizr.app/features/server-authentication#validating-the-token">Organizr - Under "Validating the token"</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_adding_jwt_details_to_olivetin_config_yaml"><a class="anchor" href="#_adding_jwt_details_to_olivetin_config_yaml"></a><a class="link" href="#_adding_jwt_details_to_olivetin_config_yaml">Adding JWT details to OliveTin config.yaml</a></h4>
<div class="paragraph">
<p>Setup your config file so it has something like this;</p>
</div>
<div class="listingblock">
<div class="title"><code>config.yaml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># It's often useful to turn logging to DEBUG when trying to work out authentication problems</span>
<span class="na">logLevel</span><span class="pi">:</span> <span class="s2">"</span><span class="s">INFO"</span>

<span class="na">authJwtCookieName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Organizr_token_1234..."</span>
<span class="na">authJwtHmacSecret</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3l4jh23v_123!"</span>
<span class="na">authJwtClaimUsername</span><span class="pi">:</span> <span class="s2">"</span><span class="s">username"</span>
<span class="na">authJwtClaimUsergroup</span><span class="pi">:</span> <span class="s2">"</span><span class="s">usergroup"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that your <code>authJwtCookieName</code> and <code>authJwtSecret</code> will need to be set exactly as they appear in your Authentication software.</p>
</div>
<div class="sect4">
<h5 id="_usable_claims"><a class="anchor" href="#_usable_claims"></a><a class="link" href="#_usable_claims">Usable claims</a></h5>
<div class="paragraph">
<p>OliveTin currently can match Access Control Lists based on a <strong>username</strong> or <strong>primary user group</strong>. These must be called <code>name</code> and <code>group</code> respectively. You can see if these are being used properly turning on <code>DEBUG</code> logging and looking at the jwt claims.</p>
</div>
</div>
<div class="sect4">
<h5 id="_setup_default_permissions"><a class="anchor" href="#_setup_default_permissions"></a><a class="link" href="#_setup_default_permissions">Setup default permissions</a></h5>
<div class="paragraph">
<p>OliveTin will assume that guests are able to View and Execute every action by default. When you are setting up authorization you probably want to limit this. You can do that by setting <code>defaultPermissions</code> like this;</p>
</div>
<div class="listingblock">
<div class="title"><code>config.yaml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">logLevel</span><span class="pi">:</span> <span class="s2">"</span><span class="s">INFO"</span>

<span class="na">defaultPermissions</span><span class="pi">:</span>
    <span class="na">view</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">exec</span><span class="pi">:</span> <span class="kc">false</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setup_olivetin_access_control_lists"><a class="anchor" href="#_setup_olivetin_access_control_lists"></a><a class="link" href="#_setup_olivetin_access_control_lists">Setup OliveTin Access Control Lists</a></h5>
<div class="paragraph">
<p>Access Control Lists are a way to override the default permissions.</p>
</div>
<div class="listingblock">
<div class="title"><code>config.yaml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">logLevel</span><span class="pi">:</span> <span class="s2">"</span><span class="s">INFO"</span>

<span class="na">defaultPermissions</span><span class="pi">:</span>
    <span class="na">view</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">exec</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">logs</span><span class="pi">:</span> <span class="kc">true</span>

<span class="na">accessControlLists</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Admins</span>
      <span class="na">addToEveryAction</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">matchUsergroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">Admins</span>
      <span class="na">permissions</span><span class="pi">:</span>
        <span class="na">view</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">exec</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">logs</span><span class="pi">:</span> <span class="kc">true</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Developers"</span>
      <span class="na">matchUsergroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">developer"</span>
      <span class="na">permissions</span><span class="pi">:</span>
        <span class="na">view</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">exec</span><span class="pi">:</span> <span class="kc">false</span>
        <span class="na">logs</span><span class="pi">:</span> <span class="kc">false</span>

<span class="na">actions</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Only visible to admins</span>
      <span class="na">shell</span><span class="pi">:</span> <span class="s">echo "I am a secret command only visible to admins"</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Restart database</span>
      <span class="na">shell</span><span class="pi">:</span> <span class="s">systemctl restart mariadb</span>
      <span class="na">acls</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">developer"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <code>admins</code> ACL is automatically added to every action, because <code>addToEveryAction</code> is true.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_field_names"><a class="anchor" href="#_customizing_field_names"></a><a class="link" href="#_customizing_field_names">Customizing field names</a></h4>
<div class="paragraph">
<p>You may need to customize the field names for your JWT authentication.</p>
</div>
<div class="listingblock">
<div class="title"><code>config.yaml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">authJwtClaimUsername</span><span class="pi">:</span> <span class="s2">"</span><span class="s">username"</span>
<span class="na">authJwtClaimUsergroup</span><span class="pi">:</span> <span class="s2">"</span><span class="s">usergroup"</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="jwt-keys.html">JWT with Keys</a> | ↑ Up: <a href="auth.html">Security</a> | ⌂ Home: <a href="index.html">OliveTin documentation</a> | Next: <a href="acls.html">Permissions &amp; Access Control</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-07-13 18:49:23 UTC
</div>
</div>
</body>
</html>