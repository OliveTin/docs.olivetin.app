<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<link rel="icon" type="image/png" href="images/icons/OliveTinLogo.png">
<title>OliveTin documentation</title>
<style>
body {
  font-family: sans-serif;
  line-height: 1.5;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-areas: "nav content" "nav footer";
  grid-template-columns: 20em auto;
  grid-template-rows: auto min-content;
  height: 100vh;
  align-items: stretch;
}

a {
  text-decoration: none;
  color: #36f;
  font-weight: bold;
}

a:focus, #toc a:focus {
  background-color: black;
  color: white;
}

a:visited {
  color: #36f;
  font-weight: bold;
}

a:hover {
  text-decoration: underline;
}

#header {
  background-color: #fafafa;
  grid-area: nav;
  box-shadow: 0 0 10px rgba(0, 0, 0, .4);
}

#footer {
  grid-area: footer;
  justify-self: center;
  align-self: end;
  padding: 1em;
}

#toc {
  padding: 1em;
}

#toc a {
  color: black;
  font-weight: normal;
}

#toc li {
  padding-bottom: .6em;
}

#toc ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

#toc ul ul {
  padding-left: 1.4em;
}

#toctitle {
  font-weight: bold;
  color: black;
}

#content ul {
  list-style: '\25b9    ';
}

h1 {
  font-size: 1.4em;
  font-weight: lighter;
  background-color: black;
  padding: .6em;
  margin: 0;
  color: white;
}

#toc a:hover {
  text-decoration: underline;
}

#content {
  background-color: white;
  grid-area: content;
  max-width: 1000px;
  padding: 1em;
  justify-self: center;
}

#content img {
  max-width: 100%;
  vertical-align: middle;
}

code {
  background-color: #f7f7f8;
}

pre {
  background-color: #f7f7f8;
  padding: 1em;
  word-wrap: break-word;
  white-space: no-wrap;
  overflow: auto;
}

table {
  border-collapse: collapse;
}

td, th {
  border: 1px solid gray;
  padding: .4em;
}

th {
  background-color: #f9f9f9;
  text-align: left;
}

.imageblock {
  float: center;
}

.imageblock.right {
  float: right;
}

.imageblock .title {
  margin-bottom: 2em;
}

.imageblock img {
  border-radius: 1em;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
}

.imageblock.right img {
  box-shadow: none;
}


.listingblock {
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
  border-radius: 1em;
}

.listingblock .title {
  border-radius: 1em 0 1em 0;
}

.listingblock .title ~ .content, .listingblock .title ~ .content pre {
  border-radius: 0 1em 0 1em;
}

.listingblock .content, .listingblock .content pre {
  border-radius: 1em;
}

hr {
  clear: both;
  border: 0;
  border-bottom: 1px solid #efefef;
  margin: 1em;
}

div.admonitionblock.note {
  background-color: beige;
}

div.admonitionblock td {
  border: 0;
}

div.admonitionblock td:first-child {
  font-weight: bold;
}

.listingblock .title {
  background-color: #efefef;
  margin-bottom: -1em;
  padding: 1em;
}

.red {
  color: white;
  border: 1px solid black;
  padding: .2em;
  font-weight: bold;
  background-color: #cc0000;
}

.red a {
  color: white;
}

@media (max-width: 700px) {
  body {
    display: block;
  }
}


</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="cloudflare-access-tunnels" class="book toc2 toc-left">
<div id="header">
<h1>OliveTin</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">OliveTin documentation</a></span></p><ul class="sectlevel1">
<li><a href="installation.html">Installation Guide</a>
</li>
<li><a href="config.html">Configuration</a>
</li>
<li><a href="reverse-proxies.html">Reverse Proxies</a>
</li>
<li><a href="actions.html">Action execution</a>
</li>
<li><a href="action-customisation.html">Action customisation</a>
</li>
<li><a href="examples.html">Action examples</a>
</li>
<li><a href="args.html">Arguments</a>
</li>
<li><a href="dashboards.html">Dashboards</a>
</li>
<li><a href="entities.html">Entities</a>
</li>
<li><a href="_integrations.html">Integrations</a>
</li>
<li><a href="auth.html">Security</a>
</li>
<li><a href="solutions.html">Solutions</a>
<ul class="sectlevel2">
<li><a href="solution-on-git-push.html">GitOps (run actions on Git Push)</a>
</li>
<li><a href="container-control-panel.html">Container Control Panel</a>
</li>
<li><a href="systemd-control-panel.html">Systemd Control Panel</a>
</li>
<li><a href="heating-control-panel.html">Heating Control Panel</a>
</li>
<li><a href="_primitive_password_protection.html">Primitive password protection</a>
</li>
<li><a href="wol.html">Wake On LAN from a container</a>
</li>
<li><a href="cloudflare-access-tunnels.html"><span class="toc-current">Cloudflare Access &amp; Tunnels</span></a>
</li>
<li><a href="_gpio_control_on_raspberry_pi.html">GPIO Control on Raspberry Pi</a>
</li>
</ul>
</li>
<li><a href="_advanced_configuration.html">Advanced Configuration</a>
</li>
<li><a href="_reference.html">Reference</a>
</li>
<li><a href="troubleshooting.html">Support &amp; Troubleshooting</a>
</li>
<li><a href="api.html">API</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="cloudflare-access-tunnels"><a class="anchor" href="#cloudflare-access-tunnels"></a><a class="link" href="#cloudflare-access-tunnels">Cloudflare Access &amp; Tunnels</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This page is marked as "earlydoc", which means that it more of a collection of notes and an early draft before this page turns into good documentation later on. It is hoped that this early form of documentation is useful to you, but please understand that most documentation pages are higher quality than this. If you have suggestions or comments, please do get in contact or consider contributing your suggestions to the OliveTin documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Several uses use Cloudflare Access &amp; Tunnels to grant access to OliveTin. There is no special configuration needed for OliveTin to work in this way, simply setup your Cloudflare tunnel to connect to OliveTin on port 1337.</p>
</div>
<div class="sect3">
<h4 id="_trusting_the_cloudflare_jwt_token"><a class="anchor" href="#_trusting_the_cloudflare_jwt_token"></a><a class="link" href="#_trusting_the_cloudflare_jwt_token">Trusting the Cloudflare JWT Token</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get your <strong>AUD</strong> Tag (<code>authJwtAud</code>)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Login to your CloudFlare dashboard and go to <a href="https://one.dash.cloudflare.com/"><strong>Zero Trust</strong></a></p>
</li>
<li>
<p>Go to <strong>Access &gt; Applications.</strong></p>
</li>
<li>
<p>Select <strong>Configure</strong> for your application.</p>
</li>
<li>
<p>On the Overview tab, copy the <strong>Application Audience (AUD) Tag</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Get your <strong>Team Domain</strong> (<code>authJwtDomain</code>)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Login to your CloudFlare dashboard and go to <a href="https://one.dash.cloudflare.com/"><strong>Zero Trust</strong></a></p>
</li>
<li>
<p>Go to <strong>Settings</strong></p>
</li>
<li>
<p>Go to <strong>Custom Pages</strong></p>
</li>
<li>
<p>Your <strong>Team Domain</strong> is shown here</p>
</li>
</ol>
</div>
</li>
<li>
<p>Get your Certs URL (<code>authJwtCertsURL</code>)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Simply add <code>cdn-cgi/access/certs</code> to your <strong>Team Domain</strong> for CloudFlare</p>
</li>
</ol>
</div>
</li>
<li>
<p>CloudFlare gives you an <code>email</code> in the claim (<code>authJwtClaimUsername</code>) and the Cookie is always called <code>CF_Authorization</code> (<code>authJwtCookieName</code>)</p>
</li>
<li>
<p>Setup your OliveTin config.yaml like follows;</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title"><code>config.yaml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">authJwtAud</span><span class="pi">:</span> <span class="s2">"</span><span class="s">asdf1234"</span>
<span class="na">authJwtDomain</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://mydomain.cloudflareaccess.com"</span>
<span class="na">authJwtCertsURL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">https://mydomain.cloudflareaccess.com/cdn-cgi/access/certs"</span>
<span class="na">authJwtClaimUsername</span><span class="pi">:</span> <span class="s">email</span>
<span class="na">authJwtCookieName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">CF_Authorization"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You may well want to set <code>logLevel: DEBUG</code> and <code>insecureAllowDumpJwtClaims: true</code> in your config when testing JWT for the first time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_trusting_the_authentication_header_not_recommended"><a class="anchor" href="#_trusting_the_authentication_header_not_recommended"></a><a class="link" href="#_trusting_the_authentication_header_not_recommended">Trusting the authentication header (not recommended)</a></h4>
<div class="paragraph">
<p>If you are using Cloudflare Access, and want to use the username given by Cloudflare in OliveTin ACLs, then you can use the Cloudflare cookie like this;</p>
</div>
<div class="listingblock">
<div class="title"><code>config.yaml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">authHttpHeaderUsername</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Cf-Access-Authenticated-User-Email"</span>

<span class="na">defaultPermissions</span><span class="pi">:</span>
    <span class="na">view</span><span class="pi">:</span> <span class="kc">false</span>
    <span class="na">exec</span><span class="pi">:</span> <span class="kc">false</span>

<span class="na">accessControlLists</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Admins</span>
      <span class="na">addToEveryAction</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">matchUsernames</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">contact@jread.com</span>
      <span class="na">permissions</span><span class="pi">:</span>
        <span class="na">view</span><span class="pi">:</span> <span class="kc">true</span>
        <span class="na">exec</span><span class="pi">:</span> <span class="kc">true</span>

<span class="na">actions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">title</span><span class="pi">:</span> <span class="s">test apprise</span>
    <span class="na">shell</span><span class="pi">:</span> <span class="s">date</span>
    <span class="na">shellAfterCompleted</span><span class="pi">:</span> <span class="s2">"</span><span class="s">apprise</span><span class="nv"> </span><span class="s">-c</span><span class="nv"> </span><span class="s">/config/apprise.yml</span><span class="nv"> </span><span class="s">-t</span><span class="nv"> </span><span class="s">'notification:</span><span class="nv"> </span><span class="s">test'</span><span class="nv"> </span><span class="s">-b</span><span class="nv"> </span><span class="s">'date</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">stdout</span><span class="nv"> </span><span class="s">}}'"</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
OliveTin does support JWT cookies that Cloudflare uses, which is arguably more secure. It&#8217;s just that nobody in the Discord has worked out how to get the keys needed from Cloudflare to decrypt this cookie yet! See the <a href="jwt.html">JWT Authorization</a> documentation for some starter points. If you figure this out, it would be most welcome to share your solution with the community.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="wol.html">Wake On LAN from a container</a> | ↑ Up: <a href="solutions.html">Solutions</a> | ⌂ Home: <a href="index.html">OliveTin documentation</a> | Next: <a href="_gpio_control_on_raspberry_pi.html">GPIO Control on Raspberry Pi</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-10-27 23:45:10 UTC
</div>
</div>
</body>
</html>